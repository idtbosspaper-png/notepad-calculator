<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Notepad Calculator 2025 (Online)</title>
  <style>
    :root { --lh: 1.5; --fs: 48px; }
    body { font-family: monospace; margin: 20px; background: #f9f9f9; }
    h2 { margin: 0 0 12px; font-size: calc(var(--fs) * 0.8); }

    #wrap { display: flex; gap: 12px; align-items: flex-start; }

    /* Shared styles for both panels */
    .panel {
      width: 50%;
      height: 75vh; /* a bit shorter to leave space for footer */
      font-size: var(--fs);
      line-height: var(--lh);
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: repeating-linear-gradient(
        to bottom,
        #fff,
        #fff calc(var(--fs) * var(--lh) - 1px),
        #eaeaea calc(var(--fs) * var(--lh))
      );
      box-sizing: border-box;
      white-space: pre;
      overflow-wrap: normal;
      overflow-y: auto;
    }

    #input {
      resize: none;
      font-family: monospace;
    }

    #results {
      color: #333;
    }

    footer {
      margin-top: 12px;
      text-align: center;
      font-size: 18px;
      color: #666;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <h2>Notepad Calculator 2025 (Online)</h2>
  <div id="wrap">
    <textarea id="input" class="panel"></textarea>
    <div id="results" class="panel"></div>
  </div>

  <footer>
    Developed by <strong>Harris</strong>
  </footer>

  <script>
    const input = document.getElementById('input');
    const results = document.getElementById('results');

    const NUM_RE = /(^|[^\w.])-?\d[\d,]*(?:\.\d+)?(?=$|[^\w.])/g;

    function formatNumberToken(token) {
      const lead = token.match(/^[^\d-]?/)?.[0] ?? '';
      const body = token.slice(lead.length);
      const cleaned = body.replace(/,/g, '');
      if (cleaned === '' || isNaN(cleaned)) return token;
      return lead + Number(cleaned).toLocaleString();
    }

    function formatTextPreserveCaret(text, caretIdx) {
      const before = text.slice(0, caretIdx);
      const after  = text.slice(caretIdx);
      const formattedBefore = before.replace(NUM_RE, formatNumberToken);
      const formattedAfter  = after.replace(NUM_RE, formatNumberToken);
      return { text: formattedBefore + formattedAfter, caret: formattedBefore.length };
    }

    function isCalcLine(raw) {
      return /[0-9]/.test(raw) && /[\+\-\*\/\(\)\.%]/.test(raw);
    }

    function computeResults(displayText) {
      const lines = displayText.split('\n');
      let out = '';
      for (const line of lines) {
        let shown = '';
        if (isCalcLine(line)) {
          try {
            const evalLine = line.replace(/,/g, '');
            const val = eval(evalLine);
            if (typeof val === 'number' && isFinite(val)) {
              shown = val.toLocaleString();
            }
          } catch (_) {}
        }
        out += (shown ? shown : ' ') + '\n';
      }
      results.textContent = out;
    }

    function onInput() {
      const oldVal = input.value;
      const caret  = input.selectionStart;
      const { text: newVal, caret: newCaret } = formatTextPreserveCaret(oldVal, caret);
      if (newVal !== oldVal) {
        input.value = newVal;
        input.setSelectionRange(newCaret, newCaret);
      }
      computeResults(newVal);
    }

    input.addEventListener('input', onInput);
    computeResults(input.value);
  </script>
</body>
</html>
